# VAE
在 Stable Diffusion 中，所有的去噪和加噪过程并不是在图像空间直接进行的。VAE 模块的作用便是将图像“压缩”到一个特殊的空间，这个空间的“分辨率”要低于图像空间，便于**快速地完成加噪和去噪的任务**。之后，还能便捷地将特殊空间“解压”到图像空间。

VAE 的全称是变分自动编码器（Variational Autoencoder），在 2013 年被提出，是自动编码器（AE，Autoencoder）的一种扩展。你可能听过很多不同的名词，比如 AE、VAE、DAE、MAE、VQVAE 等。其实这些带 “AE” 的名字，你都可以理解成是一个编码器和一个解码器。

VAE 和 Transformer 中的编码器、解码器解决的是不同类型的问题，并具有不同的结构和原理。


## 潜在空间
在正式学习 VAE 之前。我们先要了解潜在空间的概念，也就是开头我们提起的“特殊空间”。我们可以通过神经网络，在保留原始数据的关键信息的条件下，将输入的原始数据压缩到一个更低维度的空间，得到一个低维的向量表示，并且这个低维的向量表示可以通过解码恢复出原始的数据。

这里的低维空间就是潜在空间（latent space，也称为隐空间），低维的向量也叫潜在表示（latent representation）。你可以这样理解，潜在空间是较低维度的空间，用于表示原始数据的结构和特征。潜在表示便是原始数据在潜在空间中对应的特征向量。

<img src="./images/VAE.png" />

对于 AI 绘画任务而言，潜在空间的维度通常是原始图像的 1/8 大小。例如，原始图像的分辨率如果是 512x512，潜在空间的大小就可以是 64x64。我们在 64x64 的空间上进行加噪和去噪，自然比在原始图像分辨率上进行加噪和去噪要快得多。得到去噪后的潜在表示，只需要经过解码器便可以获得 AI 绘画的最终输出图像。