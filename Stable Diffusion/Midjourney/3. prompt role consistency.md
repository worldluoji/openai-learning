# role consistency
截止到目前，Midjourney已经更新了两大控制一致性的参数，分别是–sref和–cref，它俩分别用来控制整体风格和人物角色，可谓是各自优点很明显。

我们来看下它们的区别和用法：

–Sref
- 主要用处：风格参考、风格迁移
- 使用格式：–Sref（空格）图片链接（空格）–sw（空格）0-1000
- –sw（style weight）参数区间：0:关闭 100:默认 1000:最大值  
- sw数值说明：值越小越柔和，值越大细节越多，画面锐度越高；数值越高，生成的图像与参考图像的风格就越相似；数值越低，画面就越接近提示词直出的效果。经过测试，个人觉得数值在 250 左右效果较好，超过 500 画面容易出现扭曲变形。
- 支持模型：V 6、Niji 6或更高
- 参数支持调节不同图像的权重，方法是在图像链接后加上双半角冒号和数值，比如：--sref urlA::2 urlB::3 urlC::5；此处的权重是相对的，即 2:3:5 的效果与 4:6:10 是一样的。

–Cref
- 主要用处：角色参考、角色迁移, Character Reference 功能能确保角色形象的一致
- 使用格式：–Cref（空格）1或多个图片链接（空格）–cw（空格）0-100
- –cw参数区间：0:关闭 100:默认 1000:最大值
- 参数说明：0:只有面部迁移（适合修改衣服、发型的情况下使用）100:衣服、面容、发型、服装穿搭全部迁移
- 支持模型：V 6、Niji 6或更高

官方强调该功能目前在生成 Midjourney 自身图像时效果最佳，但对于照片或其他图像的效果可能存在不稳定性。然而，在实际测试中，用户可能会发现，即使使用 Midjourney 生成的图像， --cref 也无法完全实现100%的相似度。尽管在服装和发型上有很高的相似度，但五官仍然会呈现一些差异。

一种十分有效的方法：应当尽可能地增加参考图像中人物面部的比例。也就是说，**在创建参考图像时，我们可以选择使用关键词“头部特写”或者详细描述人物眼睛等特征，以确保人物的脸部在图像中占据主导地位**，五官细节清晰；随后，在使用--cref生成图像时，可以有效提高人物面部的相似度。

<br>

## Image Prompt垫图
在MidJourney这样的AI绘图平台中，"Image Prompt垫图"（也常简称为"垫图"）是一种技术或策略，指的是在生成新的图像时，使用已有的图片作为基础或灵感来源，来引导AI生成更加符合特定需求或预期效果的图像。具体来说，垫图功能的工作方式大致如下：

1. **参考图像**: 用户上传一张图片作为生成新图像的参考或“垫底”。这张图片可以是任何形式的艺术作品、照片、设计草图等，其目的是为AI提供视觉线索，比如色彩搭配、构图、风格等。

2. **融合与指导**: AI系统会分析这张参考图，并尝试在其基础上生成新的内容，同时也可以结合文本提示（Text Prompt）来进一步指导图像的生成方向。这样，生成的图像既包含了原始图像的一些特征，又融合了用户通过文本想要表达的新创意或变化。

3. **创造性控制**: 使用垫图可以帮助用户在AI生成艺术作品的过程中保留一定的控制权，尤其是在追求特定视觉效果、风格匹配或在创作系列作品时，垫图可以作为一个强有力的辅助工具。

4. **技术实现**: 在Midjourney中，这种操作可能涉及到特定的命令行参数，如使用`/image`指令时，用户可以附加参考图像的URL，并可能通过额外的参数（如`--init-image`）来指定垫图，以及调整图像生成的其他设置。

总之，垫图是Midjourney用户利用现有视觉素材引导AI创造出既有新意又符合特定目标图像的一个实用功能，它增强了创作的灵活性和个性化。

<br>

## –Sref 与 Image Prompt 垫图的区别
Style Reference的问世引发了人们对其与Image Prompt垫图之间区别的疑问，这个问题想必许多人都会产生。我进行了多组图像对比测试，结果表明，二者在功能上具有相似之处，都能提取图像的风格特征并生成类似的新图像，然而在具体的学习内容方面则存在一些区别。

Style Reference更着重于学习图像的**美学风格和氛围特征**，而Image Prompt则侧重于学习垫图在**内容元素、色彩以及构图**等方面的特征。以三张插画为例，虽然它们都具有扁平风格，但在生成多组图像后，我们会发现使用垫图生成的图像在颜色上更接近原图，人物大多穿着蓝色外套、黄色裤子，与原图中的人物相似；而通过Style Reference生成的图像只是在画风上与原图相似，但人物和装饰元素的细节却与原图有很大的差异。

<img src="./images/sref vs dt1.jpg" />

在人物照片对比组方面，垫图生成的人物特征和动作姿势更贴近原始图片，呈现出更加逼真的效果；而sref在内容上更具灵活性，同时风格与原图相似，都属于温柔的棕色系。在抽象壁纸对比组中，sref更为精准地保留了物体表面的磨砂感和柔和氛围；而垫图则在构图上与原图更加相似，受到提示词的影响呈现出水的质感。

<img src="./images/sref vs dt2.jpg" />

### 建议
若您希望生成的图像与某张现有图像高度相似，应选择使用Image Prompt。该功能能够精确复制原图的细节特征，包括元素、构图和颜色等要素。而若您只想模仿某张图像的美学风格，那么最好选用Style Reference。这一功能能更准确地模拟原图的材质和氛围特点，无需担心原图特征对新图像生成造成干扰。

另外，值得注意的是，所使用的提示词将极大地影响Style Reference的效果。若提示词详细描述了原图内容，那么Style Reference和Image Prompt都能较为成功地复制原图风格；而若描述较为简洁，那么Style Reference将会与原图有明显差异，而Image Prompt则可以一定程度上保留原图在构图和元素方面的特征。

此外 Style Reference 和 Image Prompt 是可以同时使用的，写提示词时依旧是 Image Prompt 垫图链接位于句首，Style Reference 图像链接跟在 --sref 参数之后。二者同时使用可能获得更好的结果，但也可能会让图像质量更差。

<br>

## --cref 生成风格化头像
在官方发布的声明中指出，--cref的运行原理类似于垫图（image prompt），但更着重于角色特征。此前，我们通常使用垫图来创造风格化图像，现在可以选择采用--cref，或者将两者结合运用。下面展示了三种效果的比较，我个人认为垫图在画面元素和构图的还原方面更胜一筹；而--cref则更擅长表现人物的表情和面部细节，尽管可能会忽略背景细节。若将这两种方法结合运用，可以在一定程度上弥补彼此的不足，获得更佳的效果。

<img src="./images/cref vs dt1.jpg" />

<br>

## --cref 生成艺术摄影
目前，在稳定扩散生态系统中，使用AI生成艺术摄影非常流行。这是因为控制网络、反应器、ip适配器等技术的支持，可以在保留人物形象特征的同时，进一步进行艺术加工。现在，Midjourney也提供了复制风格的样式参考和保持角色一致性的角色参考功能，因此可以完成类似的任务。

首先，您需要上传一张人物图像，并将其链接用于复制人物的面部特征。请记得调整CW权重参数为0，以便对人物的发型和服装进行修改。然后，您需要上传一张用于复制风格的图像，并将其链接用于样式参考。您可以适当增加SW参数以提高风格的一致性。此外，请详细描述您需要的内容，包括人物形象、动作姿势、环境特征、景物、色调、装饰元素等提示词，以获得更好的生成效果。下面是我测试的一个案例，整体效果非常出色。

<img src="./images/cref example.jpg" />