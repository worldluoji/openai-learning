# 有效编写用户故事
用户故事的特质可以总结为 3C，即 Card，Conversation 和 Confirmation。Card 是指用户故事的物理载体，即索引卡（Index Card）。
因为索引卡面积有限，不能事无巨细地写下所有需求信息，只能关注最重要的信息也就是用户价值。
其他的不可言说知识则通过对话（Conversation）的这种社交活动传播。

在对话过程中，最重要的目标就是明确这张故事卡的验收条件（Acceptance Criteria）有哪些，也就是如何确认（Confirmation）卡确实做完了。
因而，验收条件是用户故事（User Story）的重要组成部分，用于帮助开发团队和客户明确产品或功能的期望表现、功能要求和可接受的标准。


一个用户故事的例子如下：

<strong>作为</strong>学校的教职员工（As a faculty），
<strong>我希望</strong>学生可以根据录取通知将学籍注册到教学计划上（I want the student to be able to enroll in an academic program with given offer），
<strong>从而<strong>我可以跟踪他们的获取学位的进度（So that I can track their progress）

在这个用户故事里，我们并没有提及具体的技术方案到底是什么。这也就是用户故事与功能需求的一个重大差异。
<strong>用户故事侧重于定义问题，而功能需求往往包含着解决方案</strong>。


在使用 LLM 辅助时，问题的定义是困难的，而获取解决方案则容易得多。就以这个用户故事为例，我们可以很容易地让 LLM 给出不同的技术解决方案。比如想要实现为 Web UI：
```
用户故事
=======
作为学校的教职员工（As a faculty），
我希望学生可以根据录取通知将学籍注册到教学计划上（I want the student to be able to enroll in an academic program with given offer），
从而我可以跟踪他们的获取学位的进度（So that I can track their progress）
任务
===
请为这个用户故事设计基于Web的交互流程
```
再比如，我们也可以让 LLM 帮助我们将这个需求实现为 RESTful API：
```
用户故事
=======
作为学校的教职员工（As a faculty），
我希望学生可以根据录取通知将学籍注册到教学计划上（I want the student to be able to enroll in an academic program with given offer），
从而我可以跟踪他们的获取学位的进度（So that I can track their progress）
任务
===
请为这个用户故事设计API
```

## 如何有效编写用户故事
我们常用的用户故事格式通常是三段式：
```
As a/ 作为 < 角色 > 
I’d like to/ 我希望 < 功能 > 
So that/ 从而可以 < 价值 >
```
首先需要注意的是：对于任何一个用户故事而言，角色 - 价值是不变的，而功能可以随时发生改变，是用户故事中“可协商”的部分。
换句话说，角色 - 价值定义了要解决的问题，而功能只是解决这个问题的一种方法而已。

第二点需要注意的是找到<strong>真正的价值</strong>。真正的价值并不一定发生在发起操作的这个角色身上。例如一个用户故事：
```
As a 注册用户
I’d like to 通过用户名 / 密码登录系统
So that 访问我的个人信息
```
这里价值体现在“注册用户 - 访问我的个人信息”，而不是“系统管理员 - 追踪不同用户的行为”。
那么我们就需要区分哪个才是真正的价值。也就是登录是系统管理员受益更多，还是注册用户受益更多？


第三点就是如何编写<strong>有意义的价值陈述</strong>。
价值陈述需要从用户故事拆分的方式入手，才能找到合理的切入点去阐述，否则容易陷入对于功能的复述。

<img src="./images/%20一种用户故事拆分方式.webp" />

按照这样的方式拆分用户故事时，我们需要找到不同用户角色的目标，并根据这些目标设计整体解决方案。整体解决方案中包含业务中的核心概念、关键规则和主要流程。
然后我们再根据整体解决方案，设计不同角色的用户旅程。接着我们就可以从用户旅程上切分用户故事了。
那么此时，用户故事只有三种写法：
- So that 可以满足某个用户角色的目标
- So that 可以满足整体解决方案的规则或流程
- So that 可以进行用户旅程的下一步


在 LLM 的时代，我们应该永远优先聚焦于问题的定义，然后才是解决方案。用户故事恰好符合这些条件，所以它是适用于 LLM 的需求表示形式。

<br>

## 验收条件
通常，验收条件遵循 假设 / 操作 / 结果（Given/When/Then） 格式，这个格式能帮我们清晰地描述功能的期望行为。


我们需要给出一定的业务上下文，比如：
```
整个学籍管理系统是一个 Web 应用； 
当教职员工发放录取通知时，会同步建立学生的账号；
学生可以根据身份信息，查询自己的账号；
在报道注册时，学生登录账号，按照录取通知书完成学年的注册；
```

比如, 根据用户故事和上述业务上下文，可以有以下验收条件：
```
Given 未完成注册的学生登录系统（用户旅程：在报道注册时，学生登录账号）
When 学生在注册页面点击“注册”按钮时（整体解决方案：整个学籍管理系统是一个 Web 应用）
Then 完成当前学期的学籍注册 （用户故事：我希望学生可以根据录取通知将学籍注册到教学计划上）
```

用户故事只是业务价值的占位符（Placeholder）。<strong>在沟通确认之前，它只表示用户想要达到的某种目的，而具体的功能需要在沟通中才能细化</strong>。

<br>

## 使用 LLM 辅助用户故事编写
我们是否能够有效理解用户故事，重点并不在故事本身，而在于对于整体解决方案和用户旅程的掌握程度。因为用户故事只是业务价值的占位符。

按照这个思路，通过 LLM 辅助我们编写用户故事的前提是，我们已经有效地提取了整体解决方案和用户旅程。

我们可以通过一个推理行动模式（Reasoning and act，ReAct）的变体<strong>想 - 问 - 答（TQA，Think-Question-Answer）</strong>，
使用 LLM 辅助我们编写用户故事。


由于 LLM 不善于定义问题，那么定义问题的部分仍需留给人来完成，因而 TQA 的整体思路这样的：
- 为 LLM 提供整体解决方案和用户旅程作为业务背景说明；
- 提供相应的用户故事卡；
- 让 LLM 根据业务背景说明，考虑对于给定的用户故事，还有哪些不清楚的地方，并根据这些不清楚的地方进行提问，并由人来回答；
- 当 LLM 觉得已经了解了所有的细节，那么 LLM 会为当前的用户故事编写验收条件。